"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.fetchPayload = fetchPayload;
exports.fetchRecPayload = fetchRecPayload;
const axios_1 = __importDefault(require("axios"));
const buffer_1 = require("buffer");
const generateErrorObject_1 = require("./utils/generateErrorObject");
const zeroPad_1 = __importDefault(require("./utils/zeroPad"));
async function fetchPayload({ url, DPP = new Date().toISOString().substring(0, 10), codMun = 5300108, }) {
    const axiosOptions = {
        params: {
            DPP,
            codMun: (0, zeroPad_1.default)(codMun, 7),
        },
    };
    return axios_1.default
        .get(`https://${url}`, axiosOptions)
        .then(({ data, status }) => {
        if (status !== 200)
            return (0, generateErrorObject_1.generateErrorObject)('Status != 200');
        return data;
    })
        .then((jws) => {
        const parts = jws.split('.').map((b64) => buffer_1.Buffer.from(b64, 'base64'));
        const pixFetch = {
            jwsString: jws,
            jws: {
                hdr: parts[0],
                payload: parts[1],
                signature: parts[2],
            },
            header: JSON.parse(parts[0].toString()),
            payload: JSON.parse(parts[1].toString()),
        };
        return pixFetch;
    })
        .catch((error) => {
        return (0, generateErrorObject_1.generateErrorObject)(error.message);
    });
}
async function fetchRecPayload({ url, }) {
    return axios_1.default
        .get(`https://${url}`)
        .then(({ data, status }) => {
        if (status !== 200)
            return (0, generateErrorObject_1.generateErrorObject)('Status != 200');
        return data;
    })
        .then((jws) => {
        const parts = jws.split('.').map((b64) => buffer_1.Buffer.from(b64, 'base64'));
        const pixFetch = {
            jwsString: jws,
            jws: {
                hdr: parts[0],
                payload: parts[1],
                signature: parts[2],
            },
            header: JSON.parse(parts[0].toString()),
            payload: JSON.parse(parts[1].toString()),
        };
        return pixFetch;
    })
        .catch((error) => {
        return (0, generateErrorObject_1.generateErrorObject)(error.message);
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pY1BheWxvYWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZHluYW1pY1BheWxvYWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUF1Q0Esb0NBa0NDO0FBRUQsMENBMEJDO0FBckdELGtEQUFpRTtBQUNqRSxtQ0FBZ0M7QUFHaEMscUVBQWtFO0FBQ2xFLDhEQUFzQztBQWtDL0IsS0FBSyxVQUFVLFlBQVksQ0FBQyxFQUNqQyxHQUFHLEVBQ0gsR0FBRyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsRUFDL0MsTUFBTSxHQUFHLE9BQU8sR0FDRDtJQUNmLE1BQU0sWUFBWSxHQUF1QjtRQUN2QyxNQUFNLEVBQUU7WUFDTixHQUFHO1lBQ0gsTUFBTSxFQUFFLElBQUEsaUJBQU8sRUFBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1NBQzNCO0tBQ0YsQ0FBQztJQUNGLE9BQU8sZUFBSztTQUNULEdBQUcsQ0FBQyxXQUFXLEdBQUcsRUFBRSxFQUFFLFlBQVksQ0FBQztTQUNuQyxJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQWlCLEVBQUUsRUFBRTtRQUN4QyxJQUFJLE1BQU0sS0FBSyxHQUFHO1lBQUUsT0FBTyxJQUFBLHlDQUFtQixFQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ2hFLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQyxDQUFDO1NBQ0QsSUFBSSxDQUFDLENBQUMsR0FBVyxFQUFFLEVBQUU7UUFDcEIsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLGVBQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDdEUsTUFBTSxRQUFRLEdBQW9CO1lBQ2hDLFNBQVMsRUFBRSxHQUFHO1lBQ2QsR0FBRyxFQUFFO2dCQUNILEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNiLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNqQixTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQzthQUNwQjtZQUNELE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUN2QyxPQUFPLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQWU7U0FDdkQsQ0FBQztRQUNGLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUMsQ0FBQztTQUNELEtBQUssQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO1FBQ2YsT0FBTyxJQUFBLHlDQUFtQixFQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM1QyxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUM7QUFFTSxLQUFLLFVBQVUsZUFBZSxDQUFDLEVBQ3BDLEdBQUcsR0FDZTtJQUNsQixPQUFPLGVBQUs7U0FDVCxHQUFHLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztTQUNyQixJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQWlCLEVBQUUsRUFBRTtRQUN4QyxJQUFJLE1BQU0sS0FBSyxHQUFHO1lBQUUsT0FBTyxJQUFBLHlDQUFtQixFQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ2hFLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQyxDQUFDO1NBQ0QsSUFBSSxDQUFDLENBQUMsR0FBVyxFQUFFLEVBQUU7UUFDcEIsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLGVBQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDdEUsTUFBTSxRQUFRLEdBQXVCO1lBQ25DLFNBQVMsRUFBRSxHQUFHO1lBQ2QsR0FBRyxFQUFFO2dCQUNILEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNiLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNqQixTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQzthQUNwQjtZQUNELE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUN2QyxPQUFPLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQWtCO1NBQzFELENBQUM7UUFDRixPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDLENBQUM7U0FDRCxLQUFLLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtRQUNmLE9BQU8sSUFBQSx5Q0FBbUIsRUFBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDNUMsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDIn0=